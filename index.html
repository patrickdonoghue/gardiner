<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RDLG Data Collection</title>
  <style>
    :root { --bg:#0b0c10; --card:#121318; --ink:#e6e6e6; --muted:#a6a6a6; --accent:#4895ef; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--ink);}
    .wrap{max-width:820px;margin:0 auto;padding:16px}
    header{padding:20px 12px 8px}
    h1{margin:0;font-size:clamp(20px,4vw,28px);font-weight:700}
    .subtitle{color:var(--muted);font-size:14px;margin-top:4px}
    .card{background:var(--card);border:1px solid #1f2030;border-radius:16px;padding:16px;box-shadow:0 8px 24px rgb(0 0 0 / 25%)}
    .row{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:600px){ .row{grid-template-columns: 1fr 1fr} }
    .item{display:flex;flex-direction:column;padding:12px;border:1px dashed #2a2c40;border-radius:12px;min-height:70px}
    .label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em}
    .value{margin-top:6px;font-size:15px;word-break:break-word}
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
    button{appearance:none;border:1px solid #2b2d42;background:#1a1b26;color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    button.primary{background:var(--accent);border-color:transparent;color:white}
    button:disabled{opacity:.6;cursor:not-allowed}
    .note{color:var(--muted);font-size:12px;margin-top:8px}
    a.link{color:var(--accent);text-decoration:none}
    a.link:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>RDLG Data Collection</h1>
      <div class="subtitle">Page Name: <strong>Device Data</strong></div>
    </header>

    <main class="card" role="main">
      <div class="row" id="dataGrid" aria-live="polite">
        <div class="item"><span class="label">Device Type</span><span class="value" id="deviceType">Detecting…</span></div>
        <div class="item"><span class="label">Manufacturer / Model</span><span class="value" id="oemModel">Detecting…</span></div>
        <div class="item"><span class="label">Operating System</span><span class="value" id="os">Detecting…</span></div>
        <div class="item"><span class="label">Internet Available</span><span class="value" id="internet">Checking…</span></div>
        <div class="item"><span class="label">LAN Active</span><span class="value" id="lan">Unknown</span></div>
        <div class="item"><span class="label">WAN Active</span><span class="value" id="wan">Unknown</span></div>
        <div class="item"><span class="label">Location</span><span class="value" id="location">Permission required</span></div>
        <div class="item"><span class="label">Date and Time</span><span class="value" id="dateTime">—</span></div>
      </div>

      <div class="actions">
        <button id="refreshBtn" title="Re-run detections">Refresh</button>
        <button id="locBtn" title="Request GPS location">Get Location</button>
        <button id="permBtn" title="Request any needed permissions (e.g., location)">Enable Data Collection</button>
        <button id="modelBtn" title="Try to read phone model (no prompt shown)">Try Model Detection</button>
        <button id="downloadBtn" class="primary" title="Download all fields as a .txt file">Download as .txt</button>
      </div>
      <div class="note">Note: Some fields depend on browser support and user permission (e.g., GPS). LAN/WAN are inferred from the Network Information API when available.</div>
    </main>

    <footer style="padding:14px 8px 0;">
      <small class="note">© <span id="year"></span> RDLG</small>
    </footer>
  </div>

  <script>
    const els = {
      deviceType: document.getElementById('deviceType'),
      os: document.getElementById('os'),
      internet: document.getElementById('internet'),
      lan: document.getElementById('lan'),
      wan: document.getElementById('wan'),
      location: document.getElementById('location'),
      dateTime: document.getElementById('dateTime'),
      oemModel: document.getElementById('oemModel'),
      year: document.getElementById('year'),
      refreshBtn: document.getElementById('refreshBtn'),
      locBtn: document.getElementById('locBtn'),
      permBtn: document.getElementById('permBtn'),
      modelBtn: document.getElementById('modelBtn'),
      downloadBtn: document.getElementById('downloadBtn')
    };

    function formatTZ(date = new Date()){
      try {
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const formatted = new Intl.DateTimeFormat(undefined, {
          year:'numeric', month:'2-digit', day:'2-digit',
          hour:'2-digit', minute:'2-digit', second:'2-digit',
          hour12:false, timeZoneName:'short'
        }).format(date);
        return `${formatted} (${tz})`;
      } catch { return date.toString(); }
    }

    function getOSInfo(){
      const ua = navigator.userAgent || '';
      const plt = navigator.platform || '';
      const uaData = navigator.userAgentData || null;
      let os = 'Unknown';
      if (ua.includes('Windows')) {
        const ver = (ua.match(/Windows NT ([0-9_.]+)/) || [])[1];
        os = `Windows ${ver ? 'NT ' + ver : ''}`.trim();
      } else if (/Android/i.test(ua)) {
        const ver = (ua.match(/Android\s([0-9._]+)/i) || [])[1];
        os = `Android ${ver || ''}`.trim();
      } else if (/iPhone|iPad|iPod/.test(ua)) {
        const ver = (ua.match(/OS\s([0-9_]+)/) || [])[1];
        os = `iOS ${ver ? ver.replaceAll('_','.') : ''}`.trim();
      } else if (/Mac OS X/.test(ua)) {
        const ver = (ua.match(/Mac OS X\s([0-9_]+)/) || [])[1];
        os = `macOS ${ver ? ver.replaceAll('_','.') : ''}`.trim();
      } else if (/Linux/.test(ua)) { os = 'Linux'; }
      // Try UA-CH platform (e.g., "Android", "Windows")
      if (uaData?.platform){ os = `${uaData.platform}${os && !ua.includes(uaData.platform) ? ' ('+os+')' : ''}`; }
      return os + (plt ? ` [${plt}]` : '');
    }

    function getDeviceType(){
      const ua = navigator.userAgent || '';
      const uaData = navigator.userAgentData || null;
      let name = 'Unknown device';
      if (/iPhone/.test(ua)) name = 'Apple iPhone';
      else if (/iPad/.test(ua)) name = 'Apple iPad';
      else if (/Macintosh/.test(ua)) name = 'Apple Macintosh';
      else if (/Android/.test(ua)) name = 'Android Device';
      else if (/Windows/.test(ua)) name = 'Windows PC';
      else if (/Linux/.test(ua)) name = 'Linux Device';

      const model = uaData?.mobile ? 'Mobile' : (ua.includes('Tablet') ? 'Tablet' : 'Desktop/Laptop');
      const extras = [];
      if ('deviceMemory' in navigator) extras.push(`${navigator.deviceMemory}GB RAM`);
      if ('hardwareConcurrency' in navigator) extras.push(`${navigator.hardwareConcurrency} cores`);
      return `${name}${extras.length? ' — ' + extras.join(', ') : ''} [${model}]`;
    }

    function updateConnectivity(){
      const online = navigator.onLine;
      els.internet.textContent = online ? 'Yes' : 'No';

      const c = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      // Reset
      els.lan.textContent = 'Unknown';
      els.wan.textContent = 'Unknown';
      if (c && 'type' in c) {
        const t = c.type; // wifi, cellular, ethernet, none, etc.
        if (t === 'wifi' || t === 'ethernet') els.lan.textContent = 'Yes';
        if (t === 'cellular') els.wan.textContent = 'Yes';
        if (t === 'none') { els.lan.textContent = 'No'; els.wan.textContent = 'No'; }
      } else if (c && 'effectiveType' in c) {
        // Infer: 4g/3g usually WAN; keep Unknown if we can't be sure
        if (['slow-2g','2g','3g','4g'].includes(c.effectiveType)) {
          els.wan.textContent = 'Possibly';
        }
      }
    }

    async function getLocation(){
      if (!('geolocation' in navigator)) {
        els.location.textContent = 'Geolocation not supported';
        return;
      }
      els.location.textContent = 'Requesting permission…';
      navigator.geolocation.getCurrentPosition(
        (pos)=>{
          const { latitude, longitude, accuracy } = pos.coords;
          els.location.textContent = `${latitude.toFixed(6)}, ${longitude.toFixed(6)} (±${Math.round(accuracy)}m)`;
        },
        (err)=>{
          els.location.textContent = `Unavailable (${err.message})`;
        },
        { enableHighAccuracy:true, timeout:12000, maximumAge:0 }
      );
    }

    function updateDate(){ els.dateTime.textContent = formatTZ(new Date()); }

    function makeTextBlob(){
      return `RDLG Data Collection
Page Name: Device Data
Device Type: ${els.deviceType.textContent}
Manufacturer/Model: ${els.oemModel.textContent}
Operating System: ${els.os.textContent}
Internet Available: ${els.internet.textContent}
LAN Active: ${els.lan.textContent}
WAN Active: ${els.wan.textContent}
Location (GPS): ${els.location.textContent}
Date and Time: ${els.dateTime.textContent}`;
    }

    function downloadTxt(){
      const blob = new Blob([makeTextBlob()], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Device_Data_${new Date().toISOString().replace(/[:.]/g,'-')}.txt`;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
    }

    async function updateModel(){
      els.oemModel.textContent = 'Detecting…';
      try {
        const ua = navigator.userAgent || '';
        const uaData = navigator.userAgentData;
        let model = '';

        // UA-Client Hints (Chrome/Android typically)
        if (uaData && uaData.getHighEntropyValues) {
          try {
            const res = await uaData.getHighEntropyValues(['model']);
            model = res?.model || '';
          } catch {}
        }

        // Fallback parse from legacy UA
        if (!model) {
          const m = ua.match(/(SM-[A-Z0-9]+|Pixel [A-Za-z0-9 ]+|ONEPLUS [A-Z0-9]+|CPH[0-9]+|MI [A-Z0-9 ]+|Redmi [A-Za-z0-9 ]+|Moto [A-Za-z0-9]+|XT[0-9]+|HUAWEI [A-Za-z0-9-]+)/);
          if (m) model = m[1];
        }

        // Infer brand
        let brand = '';
        if (/iPhone|iPad|iPod/.test(ua)) { brand = 'Apple'; model = model || (ua.match(/(iPhone|iPad|iPod)/)||[])[1]; }
        else if (/Samsung|SM-/.test(ua) || /^SM-/.test(model)) brand = 'Samsung';
        else if (/Pixel/.test(model)) brand = 'Google';
        else if (/ONEPLUS|CPH/.test(model) || /OnePlus/.test(ua)) brand = 'OnePlus';
        else if (/HUAWEI/.test(model) || /Huawei/i.test(ua)) brand = 'Huawei';
        else if (/(MI |Redmi)/.test(model) || /Xiaomi/i.test(ua)) brand = 'Xiaomi';
        else if (/(Moto|XT)/.test(model) || /Motorola/i.test(ua)) brand = 'Motorola';

        if (model) {
          els.oemModel.textContent = brand ? `${brand} ${model}` : model;
        } else {
          els.oemModel.textContent = 'Not available (browser privacy limits)';
        }
      } catch {
        els.oemModel.textContent = 'Not available';
      }
    }

    function init(){
      els.deviceType.textContent = getDeviceType();
      els.os.textContent = getOSInfo();
      updateConnectivity();
      updateDate();
      updateModel();
      els.year.textContent = new Date().getFullYear();
    }

    // Event bindings
    window.addEventListener('online', updateConnectivity);
    window.addEventListener('offline', updateConnectivity);
    if (navigator.connection) {
      navigator.connection.addEventListener?.('change', updateConnectivity);
    }
    els.refreshBtn.addEventListener('click', init);
    els.locBtn.addEventListener('click', getLocation);
    els.permBtn.addEventListener('click', async () => {
      await getLocation();
      try {
        if ('permissions' in navigator) {
          const geo = await navigator.permissions.query({ name: 'geolocation' });
          els.location.title = `Geolocation permission: ${geo.state}`;
        }
      } catch {}
      await updateModel();
      updateConnectivity();
      updateDate();
    });
    els.modelBtn.addEventListener('click', async () => {
      await updateModel();
      try {
        const uaData = navigator.userAgentData;
        const supportsModel = !!(uaData && uaData.getHighEntropyValues);
        const msg = supportsModel
          ? 'Browser supports UA-Client Hints model detection. If still empty, this device/browser does not expose a model string.'
          : 'This browser does not support UA-Client Hints model detection.';
        els.oemModel.title = msg;
      } catch {}
    });
    els.downloadBtn.addEventListener('click', downloadTxt);

    // Kickoff
    init();
  </script>





</body>
</html>
